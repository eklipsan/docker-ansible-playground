# Docker ansible playground

## Введение

Этот проект представляет собой среду на базе Docker, предназначенную для тестирования Ansible. В ней имеется мастер-контейнер, оснащенный Ansible, SSH и другими необходимыми инструментами для оркестровки и автоматизации задач на нескольких рабочих контейнерах. И главный, и рабочие контейнеры используют систему **Debian**. Это полезно для студентов, желающих изучить Ansible в контролируемой, изолированной среде.

## Особенности

- **Изолированная среда разработки**: Использует Docker для создания изолированной среды, имитирующей производственные системы.
- **Ansible Ready**: Мастер-контейнер поставляется с предустановленной конфигурацией Ansible, что позволяет сразу же тестировать и разрабатывать плейбуки.
- **Простая конфигурация**: проект создает docker volume между папкой ansible_files на вашем локальном узле и папкой ansible на мастер-контейнере. Это позволяет легко взаимодействовать с ansible через удобный текстовый редактор, то есть вы можете изменить папку ansible_files, которая отражает текущие настройки ansible на мастер-контейнере.
- **SSH-доступ**: Настроен для доступа по SSH, чтобы облегчить взаимодействие со всеми контейнерами.

## Предварительные условия

Все, что вам нужно, - это только Docker (Docker Compose) и, если вы используете Windows, терминал с поддержкой unix-команд (например, git bash).

## Начало работы

### Установка
1. **Склонируйте этот репозиторий и перейдите в папку "docker-ansible-playground "**
   ```bash
   git clone https://github.com/eklipsan/docker-ansible-playground.git
   cd docker-ansible-plaground
   ```
2. **Сборка и запуск контейнеров**:
   Используйте удобный bash-скрипт `init_ansible_playground.sh` для настройки  установки ansible.
   ```bash
   chmod +x init_ansible_playground.sh
   ./init_ansible_playground.sh
   ```
P.S. Если вы разворачиваете проект на https://labs.play-with-docker.com, то вам просто нужно использовать значения по умолчанию, указанные в квадратных скобках, просто нажав Enter.

3. С помощью этого скрипта вам будут заданы вопросы по настройке ansible playground. Небольшая инструкция, как правильно его настроить:
   - Введите адрес подсети, имеющей доступ к Интернету, для лучшей работы с ansible, с сокращенной маской, например 192.168.1.0/24
   - Введите адрес шлюза введенной вами подсети. Пример 192.168.1.1
   - Теперь вам нужно ввести ip-адреса для главного и рабочего контейнеров. Введите адреса, которые входят в ранее введенную подсеть, и те, которые свободны. Например, 192.168.213
После ввода параметров начнется процесс сборки контейнеров (1-2 минуты), по окончании которого вы сможете войти в контейнер либо с помощью ssh-соединения, либо с помощью команды docker:
```bash
docker exec -it [имя контейнера]
```
**Предупреждение:** SSH-соединение хорошо работает в системе Linux, в отличие от Windows, из-за ее сетевых настроек по умолчанию, поэтому вы можете получить доступ к контейнеру с помощью команды

```bash
winpty docker exec -it master_debian bash
```


1. Если вы хотите закончить работу с игровой площадкой ansible, просто введите в терминале следующее:
   ```bash
   docker compose down
   ```

2. При следующем запуске ansible playground снова используйте bash-скрипт `init_ansible_playground.sh`, и вы можете задать другие адреса по сравнению с предыдущим запуском

### Конфигурационные файлы

- `Dockerfile_master` и `Dockerfile_worker`: Docker файлы для сборки главного и рабочего контейнеров, соответственно.
- `docker-compose.yaml`: Определяет и запускает мультиконтейнерное Docker-приложение.
- `ansible_files/`: Содержит файлы конфигурации и инвентаризации Ansible для выполнения плейбуков.
- `sshd_config`: Содержит модифицированные параметры ssh, позволяющие получить доступ к контейнеру по ssh.
- `.env`: Показывает переменные, используемые файлом 'docker-compose.yaml'.

## Конфигурация SSH

SSH настроен так, чтобы присоединиться к контейнеру через логин и пароль, что облегчает доступ и управление.
Если вы хотите подключиться к контейнеру явно через ssh, то имя пользователя и пароль будут 'root'
```bash
ssh root@xxx.xxx.xxx.xxx
# Затем введите слово "root"
```

## Конфигурация Ansible

Мастер-контейнер настроен с помощью Ansible и готов к запуску плейбуков для рабочих контейнеров. В файле инвентаризации `ansible_files/inventory.txt` перечислены рабочие контейнеры и их IP-адреса для Ansible. Другие параметры рабочих контейнеров можно найти в файле ansible/group_vars/workers

## Заключение

Этот проект упрощает процесс разработки и тестирования плейбуков Ansible. Предоставляя изолированную, легко настраиваемую среду, он позволяет разработчикам сосредоточиться на разработке плейбуков, не заботясь о базовой инфраструктуре.

## Обратная связь

Я буду благодарен за любую критику и предложения по этому проекту.

kshabalin11@yandex.ru

https://t.me/eklipsan
